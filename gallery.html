<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Gallery</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body {
      margin: 0;
      padding: 1.5rem;
      font-family: 'Inter', sans-serif;
      background: #05060A;
      color: #E5E7EB;
    }

    .back {
      display: inline-block;
      margin-bottom: 1rem;
      padding: .5rem 1rem;
      background: #111827;
      color: white;
      text-decoration: none;
      border-radius: 8px;
    }

    h1 {
      margin-bottom: 1.5rem;
      border-bottom: 1px solid rgba(255,255,255,.08);
      padding-bottom: .75rem;
    }

    .grid {
      columns: 4 260px;
      column-gap: 1rem;
    }

    .grid img {
      width: 100%;
      margin-bottom: 1rem;
      border-radius: 10px;
      cursor: pointer;
      transition: transform .2s ease, box-shadow .2s ease;
    }

    .grid img:hover {
      transform: scale(1.03);
      box-shadow: 0 10px 25px rgba(0,0,0,.6);
    }

    /* Lightbox */
    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.85);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .lightbox.hidden {
      display: none;
    }

    .lightbox-content {
      max-width: 85vw;
      max-height: 85vh;
      animation: popIn .25s ease;
    }

    .lightbox-content img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 14px;
    }

    .lightbox-actions {
      display: flex;
      justify-content: space-between;
      margin-top: .75rem;
    }

    .lightbox-actions a,
    .lightbox-actions button {
      background: #1e293b;
      color: white;
      padding: .5rem .9rem;
      border-radius: 6px;
      border: none;
      cursor: pointer;
      text-decoration: none;
    }

    .lightbox-actions button {
      background: #7f1d1d;
    }

    @keyframes popIn {
      from { opacity: 0; transform: scale(.92); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>

<body>

<a class="back" href="index.html">← Back</a>
<h1 id="title"></h1>
<div class="grid" id="gallery"></div>

<!-- Lightbox -->
<div id="lightbox" class="lightbox hidden">
  <div class="lightbox-content">
    <img id="lightbox-img">
    <div class="lightbox-actions">
      <a id="download-btn" download>⬇ Download</a>
      <button id="close-btn">✕</button>
    </div>
  </div>
</div>

<script>
  const supabaseClient = supabase.createClient(
    "https://whnxaenjjzemzfxpnlrq.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndobnhhZW5qanplbXpmeHBubHJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MzIxODYsImV4cCI6MjA4NDUwODE4Nn0.4iRX0FV-YKVQv1cC9-iZ6J3oebRVvJEYcP7kaIhU-d4");

  const galleryName = new URLSearchParams(location.search).get("g");
  document.getElementById("title").textContent = galleryName;

  const container = document.getElementById("gallery");
  const lightbox = document.getElementById("lightbox");
  const lightboxImg = document.getElementById("lightbox-img");
  const downloadBtn = document.getElementById("download-btn");
  const closeBtn = document.getElementById("close-btn");

  function openLightbox(src) {
    lightboxImg.src = src;
    downloadBtn.href = src;
    lightbox.classList.remove("hidden");
  }

  function closeLightbox() {
    lightbox.classList.add("hidden");
    lightboxImg.src = "";
  }

  closeBtn.onclick = closeLightbox;
  lightbox.onclick = e => { if (e.target === lightbox) closeLightbox(); };
  document.addEventListener("keydown", e => { if (e.key === "Escape") closeLightbox(); });

  async function loadImages() {
    const { data: files, error } = await supabaseClient
      .storage
      .from("galleries")
      .list(galleryName, { limit: 100 });

    if (error) {
      console.error(error);
      return;
    }

    files.forEach(file => {
      if (!file.name.match(/\.(jpg|jpeg|png|webp)$/i)) return;

      const publicUrl = supabaseClient
        .storage
        .from("galleries")
        .getPublicUrl(`${galleryName}/${file.name}`)
        .data.publicUrl;

      const img = document.createElement("img");
      img.src = publicUrl;
      img.loading = "lazy";
      img.onclick = () => openLightbox(publicUrl);

      container.appendChild(img);
    });
  }

  loadImages();
</script>

</body>
</html>
