t <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Gallery</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  background:#0b0b0b;
  color:white;
  font-family:sans-serif;
  padding:1rem;
  overflow-x:hidden;
}

.back {
  display:inline-block;
  margin-bottom:1rem;
  padding:.5rem 1rem;
  background:#1e293b;
  color:white;
  text-decoration:none;
  border-radius:6px;
}

/* Masonry */
.grid {
  columns:4 250px;
  column-gap:1rem;
}

/* Animated entrance */
.grid img {
  width:100%;
  margin-bottom:1rem;
  border-radius:8px;
  cursor:pointer;
  opacity:0;
  transform:translateY(20px);
  animation:fadeUp .5s ease forwards;
}

@keyframes fadeUp {
  to { opacity:1; transform:none; }
}

/* POPUP OVERLAY */
#overlay {
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.75);
  display:flex;
  align-items:center;
  justify-content:center;
  opacity:0;
  pointer-events:none;
  transition:opacity .3s ease;
  z-index:10;
}

#overlay.active {
  opacity:1;
  pointer-events:auto;
}

#popup {
  transform:scale(.9);
  transition:transform .3s ease;
}

#overlay.active #popup {
  transform:scale(1);
}

#popup img {
  max-width:90vw;
  max-height:85vh;
  border-radius:12px;
}

#download {
  display:block;
  margin-top:.75rem;
  text-align:center;
  background:white;
  color:black;
  padding:.5rem;
  border-radius:6px;
  text-decoration:none;
}
</style>

<script>
const supabaseClient = supabase.createClient(
  "https://whnxaenjjzemzfxpnlrq.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndobnhhZW5qanplbXpmeHBubHJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg5MzIxODYsImV4cCI6MjA4NDUwODE4Nn0.4iRX0FV-YKVQv1cC9-iZ6J3oebRVvJEYcP7kaIhU-d4"
);
</script>
</head>

<body>
<a class="back" href="index.html">‚Üê Back</a>
<h1 id="title"></h1>

<div class="grid" id="gallery"></div>

<div id="overlay">
  <div id="popup">
    <img id="popup-img">
    <a id="download" download>Download</a>
  </div>
</div>

<script>
const galleryName = new URLSearchParams(location.search).get("g");
document.getElementById("title").textContent = galleryName.replace(/-/g," ");

const overlay = document.getElementById("overlay");
const popupImg = document.getElementById("popup-img");
const downloadBtn = document.getElementById("download");
const container = document.getElementById("gallery");

let images = [];
let currentIndex = 0;
let touchStartX = 0;

/* LOAD IMAGES */
async function loadImages(){
  const { data } = await supabaseClient
    .storage.from("galleries").list(galleryName,{ limit:200 });

  data.forEach((file,i)=>{
    if(!file.name.match(/\.(jpg|jpeg|png|webp)$/i)) return;

    const { data:url } = supabaseClient.storage
      .from("galleries")
      .getPublicUrl(`${galleryName}/${file.name}`);

    images.push(url.publicUrl);

    const img = document.createElement("img");
    img.src = url.publicUrl;
    img.style.animationDelay = `${i * 40}ms`;

    img.onclick = () => openPopup(i);

    container.appendChild(img);
  });
}

function openPopup(index){
  currentIndex = index;
  updatePopup();
  overlay.classList.add("active");
}

function updatePopup(){
  popupImg.src = images[currentIndex];
  downloadBtn.href = images[currentIndex];
}

function closePopup(){
  overlay.classList.remove("active");
}

/* CLICK OUTSIDE TO CLOSE */
overlay.onclick = e => {
  if(e.target === overlay) closePopup();
};

/* SWIPE SUPPORT */
popupImg.addEventListener("touchstart", e => {
  touchStartX = e.touches[0].clientX;
});

popupImg.addEventListener("touchend", e => {
  const dx = e.changedTouches[0].clientX - touchStartX;
  if (dx > 50) prevImage();
  if (dx < -50) nextImage();
});

/* KEYBOARD NAVIGATION */
document.addEventListener("keydown", e => {
  if (!overlay.classList.contains("active")) return;

  if (e.key === "ArrowRight") nextImage();
  if (e.key === "ArrowLeft") prevImage();
  if (e.key === "Escape") closePopup();
});

function nextImage(){
  currentIndex = (currentIndex + 1) % images.length;
  updatePopup();
}

function prevImage(){
  currentIndex = (currentIndex - 1 + images.length) % images.length;
  updatePopup();
}

loadImages();
</script>
</body>
</html>
